import{u as p,a as u}from"./useMutation-Dc7l1O7O.js";import{b as s,u as i}from"./app-BMoqJylX.js";import{t as o}from"./app-layout-DnDd30U-.js";const t="/api/products",y=async(e={})=>{const r=new URLSearchParams;return e.search&&r.append("search",e.search),e.active!==void 0&&r.append("active",String(e.active)),e.en_stock!==void 0&&r.append("en_stock",String(e.en_stock)),(e.sortBy||e.sort_by)&&r.append("sort_by",e.sortBy||e.sort_by||"created_at"),(e.sortOrder||e.sort_order)&&r.append("sort_order",e.sortOrder||e.sort_order||"desc"),e.page&&r.append("page",String(e.page)),(e.perPage||e.per_page)&&r.append("per_page",String(e.perPage||e.per_page||15)),(await s.get(`${t}?${r.toString()}`)).data},g=async e=>(await s.get(`${t}/${e}`)).data.data,_=async e=>(await s.post(t,e,{headers:{"Content-Type":"multipart/form-data"}})).data.data,v=async(e,r)=>(await s.put(`${t}/${e}`,r,{headers:{"Content-Type":"multipart/form-data"}})).data.data,d=e=>{const r=new FormData;return r.append("name",e.name),r.append("price",e.price.toString()),r.append("description",e.description||""),r.append("en_stock",e.en_stock?"1":"0"),r.append("active",e.active?"1":"0"),e.image_principale instanceof File&&r.append("image_principale",e.image_principale),e.images_secondaires&&e.images_secondaires.length>0&&e.images_secondaires.forEach(a=>{a instanceof File&&r.append("images_secondaires[]",a)}),r},S=(e={})=>p({queryKey:["products",e],queryFn:async()=>await y(e)}),q=e=>p({queryKey:["product",e],queryFn:()=>g(e),enabled:!!e}),F=()=>{const e=i();return u({mutationFn:r=>{const a=d(r);return _(a)},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]}),o.success("Produit créé avec succès")},onError:r=>{console.error("Error creating product:",r),o.error("Erreur lors de la création du produit")}})},b=()=>{const e=i();return u({mutationFn:({id:r,data:a})=>{const n=d(a);return v(r,n)},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["product"]}),o.success("Produit mis à jour avec succès")},onError:r=>{if(console.error("Error updating product:",r),r?.response?.status===422){const n=r.response.data.errors,c=Object.values(n)[0],m=Array.isArray(c)?c[0]:c;o.error(m||"Erreur de validation");return}const a=r?.response?.data?.message||r?.response?.data?.error||r?.message||"Erreur lors de la mise à jour du produit";o.error(a)}})};export{F as a,b,S as c,q as u};
