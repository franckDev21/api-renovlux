import{r as F,j as e,a as k}from"./app-D5m8WAa4.js";import{c as u,d as p,k as _,g as b,u as E,a as I,F as A,b as d,I as U,e as g,f,T as M,S as C,o as R,j as w,h as D,i as P,s as L,n as B}from"./ImageUploadField-BrBroomz.js";import{c as N,B as G}from"./createLucideIcon-tfuowmrC.js";import{I as S}from"./input-Bqu5PeZB.js";import{X as z}from"./app-layout-C8Xx9Ui9.js";import{P as O}from"./plus-BZIAxUvx.js";import{a as T,b as $}from"./useProducts-h23S6bjv.js";import{L as q}from"./loader-circle-q6HgwlXi.js";function J({label:r="Images",field:t,defaultImageUrls:m=[],className:h,maxImages:c=10}){const[i,v]=F.useState([]);F.useEffect(()=>{const a=[];return t.value&&Array.isArray(t.value)&&t.value.forEach(n=>{if(n instanceof File){const x=URL.createObjectURL(n);a.push(x)}else typeof n=="string"&&a.push(n)}),a.length===0&&m.length>0&&a.push(...m),v(a),()=>{a.forEach(n=>{n&&n.startsWith("blob:")&&URL.revokeObjectURL(n)})}},[t.value,m]);const s=a=>{const n=Array.from(a.target.files||[]);if(n.length>0){const j=[...Array.isArray(t.value)?t.value.filter(y=>y instanceof File):[],...n].slice(0,c);t.onChange(j)}a.target.value=""},l=a=>{const x=(Array.isArray(t.value)?t.value.filter(j=>j instanceof File):[]).filter((j,y)=>y!==a);t.onChange(x)},o=i.length<c;return e.jsxs(u,{className:N("flex flex-col space-y-2",h),children:[r&&e.jsx(p,{children:r}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[i.map((a,n)=>e.jsx("div",{className:"relative group rounded-md border overflow-hidden",children:a?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a,alt:`Preview ${n+1}`,className:"w-full h-32 object-cover"}),e.jsx("button",{type:"button",onClick:()=>l(n),className:"absolute right-2 top-2 rounded-full bg-black/50 p-1 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(z,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center bg-muted",children:e.jsx(_,{className:"h-8 w-8 text-muted-foreground"})})},n)),o&&e.jsxs("label",{htmlFor:"multi-image-upload",className:N("relative flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 p-4 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-800/50 h-32"),children:[e.jsx("input",{id:"multi-image-upload",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:s}),e.jsx(O,{className:"mb-2 h-6 w-6 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Ajouter"})]})]}),i.length===0&&e.jsxs("label",{htmlFor:"multi-image-upload-initial",className:N("relative flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 p-8 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-800/50"),children:[e.jsx("input",{id:"multi-image-upload-initial",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:s}),e.jsx(_,{className:"mb-2 h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cliquez pour télécharger ou glisser-déposer"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF (max. 2MB par image)"})]}),e.jsx(b,{}),i.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.length," image",i.length>1?"s":""," sélectionnée",i.length>1?"s":"",c&&` (maximum ${c})`]})]})}const V=R({name:L().min(2,{message:"Le nom doit contenir au moins 2 caractères."}),price:B().min(0,{message:"Le prix doit être supérieur ou égal à 0."}),description:L().optional(),image_principale:P().optional(),images_secondaires:D(P()).optional(),en_stock:w(),active:w()});function se({product:r}){const t=!!r,m=T(),h=$(),c=t?h:m,i=E({resolver:I(V),defaultValues:{name:r?.name??"",price:r?.price??0,description:r?.description??"",en_stock:t?r?.en_stock??!0:!0,active:t?r?.active??!0:!0,image_principale:void 0,images_secondaires:[]}});F.useEffect(()=>{r&&i.reset({name:r.name,price:r.price,description:r.description||"",en_stock:r.en_stock,active:r.active,image_principale:void 0,images_secondaires:[]})},[r,i]);function v(s){const l=(s.images_secondaires||[]).filter(a=>a instanceof File),o={name:s.name,price:s.price,description:s.description||"",en_stock:s.en_stock,active:s.active,image_principale:s.image_principale instanceof File?s.image_principale:void 0,images_secondaires:l};console.log("Form data to send:",o),t&&r?h.mutate({id:r.id.toString(),data:o},{onSuccess:a=>{console.log("Produit mis à jour :",a),k.visit("/products/home",{replace:!0})},onError:a=>{console.error("Erreur lors de la mise à jour:",a)}}):(console.log("Création du produit :",o),m.mutate(o,{onSuccess:()=>{k.visit("/products/home",{replace:!0})}}))}return e.jsx(A,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(v),className:"space-y-8 p-4",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(d,{control:i.control,name:"image_principale",render:({field:s})=>e.jsx(U,{label:"Image principale",field:s,defaultImageUrl:r?.image_principale||void 0})}),e.jsxs("div",{className:"w-3/4 space-y-4",children:[e.jsx(d,{control:i.control,name:"name",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nom du produit"}),e.jsx(g,{children:e.jsx(S,{placeholder:"Nom du produit...",...s})}),e.jsx(f,{children:"Nom public du produit."}),e.jsx(b,{})]})}),e.jsx(d,{control:i.control,name:"price",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Prix"}),e.jsx(g,{children:e.jsx(S,{type:"number",step:"0.01",placeholder:"0.00",value:s.value||"",onChange:l=>{const o=parseFloat(l.target.value);s.onChange(isNaN(o)?0:o)}})}),e.jsx(f,{children:"Prix du produit en euros."}),e.jsx(b,{})]})}),e.jsx(d,{control:i.control,name:"description",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Description"}),e.jsx(g,{children:e.jsx(M,{placeholder:"Décrivez le produit en détail...",className:"min-h-[120px]",...s})}),e.jsx(b,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:i.control,name:"en_stock",render:({field:s})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{className:"text-base",children:"En stock"}),e.jsx(f,{children:"Le produit est disponible en stock."})]}),e.jsx(g,{children:e.jsx(C,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(d,{control:i.control,name:"active",render:({field:s})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{className:"text-base",children:"Produit actif"}),e.jsx(f,{children:"Le produit sera visible s'il est actif."})]}),e.jsx(g,{children:e.jsx(C,{checked:s.value,onCheckedChange:s.onChange})})]})})]})]})]}),e.jsx(d,{control:i.control,name:"images_secondaires",render:({field:s})=>e.jsx(J,{label:"Images secondaires",field:{onChange:l=>s.onChange(l),value:s.value||[]},defaultImageUrls:r?.images_secondaires||[],maxImages:10})}),e.jsxs(G,{type:"submit",disabled:c.isPending,children:[c.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Mettre à jour":"Créer le produit"]})]})})}export{se as P};
