import{u as p,a as u}from"./useMutation-B1xcFY0H.js";import{b as o,u as d}from"./app-CM9Os29j.js";import{t as a}from"./app-layout-BXH1unG1.js";const n="/api/products",y=async(e={})=>{const r=new URLSearchParams;return e.search&&r.append("search",e.search),e.active!==void 0&&r.append("active",String(e.active)),e.en_stock!==void 0&&r.append("en_stock",String(e.en_stock)),(e.sortBy||e.sort_by)&&r.append("sort_by",e.sortBy||e.sort_by||"created_at"),(e.sortOrder||e.sort_order)&&r.append("sort_order",e.sortOrder||e.sort_order||"desc"),e.page&&r.append("page",String(e.page)),(e.perPage||e.per_page)&&r.append("per_page",String(e.perPage||e.per_page||15)),(await o.get(`${n}?${r.toString()}`)).data},h=async e=>(await o.get(`${n}/${e}`)).data.data,P=async e=>(await o.post(n,e,{headers:{"Content-Type":"multipart/form-data"}})).data.data,v=async(e,r)=>(r.append("_method","PUT"),(await o.post(`${n}/${e}`,r,{headers:{"Content-Type":"multipart/form-data"}})).data.data),f=e=>{if(!e)return e;if(!e.startsWith("http://")&&!e.startsWith("https://"))return e.replace(/^storage\//,"").replace(/^\//,"");const r=e.match(/\/storage\/(.+)$/);return r&&r[1]?r[1]:e},m=e=>{const r=new FormData;return r.append("name",e.name),r.append("price",e.price.toString()),r.append("description",e.description||""),r.append("en_stock",e.en_stock?"1":"0"),r.append("active",e.active?"1":"0"),e.image_principale instanceof File&&r.append("image_principale",e.image_principale),e.existing_images_secondaires!==void 0&&(r.append("existing_images_secondaires_submitted","1"),e.existing_images_secondaires.forEach(s=>{if(s){const t=f(s);r.append("existing_images_secondaires[]",t)}})),e.images_secondaires&&e.images_secondaires.length>0&&e.images_secondaires.forEach(s=>{s instanceof File&&r.append("images_secondaires[]",s)}),r},q=(e={})=>p({queryKey:["products",e],queryFn:async()=>await y(e)}),F=e=>p({queryKey:["product",e],queryFn:()=>h(e),enabled:!!e}),w=()=>{const e=d();return u({mutationFn:r=>{const s=m(r);return P(s)},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]}),a.success("Produit créé avec succès")},onError:r=>{console.error("Error creating product:",r),a.error("Erreur lors de la création du produit")}})},x=()=>{const e=d();return u({mutationFn:({id:r,data:s})=>{const t=m(s);return v(r,t)},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["product"]}),a.success("Produit mis à jour avec succès")},onError:r=>{if(console.error("Error updating product:",r),r&&typeof r=="object"&&"response"in r){const t=r;if(t.response?.status===422){const i=t.response.data?.errors;if(i){const c=Object.values(i)[0],_=Array.isArray(c)?c[0]:c;a.error(_||"Erreur de validation");return}}const g=t.response?.data?.message||t.response?.data?.error||"Erreur lors de la mise à jour du produit";a.error(g);return}const s=r instanceof Error?r.message:"Erreur lors de la mise à jour du produit";a.error(s)}})};export{w as a,x as b,q as c,F as u};
