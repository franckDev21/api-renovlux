import{r as n,j as e}from"./app-CXlkSNpp.js";import{c as P,d as R,g as L}from"./ImageUploadField-D56VYx-p.js";import{c as y}from"./createLucideIcon-TuM7M0fl.js";import{X as G}from"./app-layout-BAa8lCS0.js";import{I as w}from"./image-DALyzu55.js";import{P as S}from"./plus-Ct8jtTmn.js";function T({label:b="Images",field:l,defaultImageUrls:u=[],existingImageUrls:i=[],onExistingImagesChange:I,className:k,maxImages:c=10}){const[x,m]=n.useState(i.length>0?i:u),[g,A]=n.useState([]),j=n.useId(),v=n.useId();n.useEffect(()=>{i.length>0?m(i):m(u)},[i,u]),n.useEffect(()=>{const s=(Array.isArray(l.value)?l.value.filter(t=>t instanceof File):[]).map((t,a)=>({url:URL.createObjectURL(t),fileIndex:a}));return A(s),()=>{s.forEach(t=>{t.url.startsWith("blob:")&&URL.revokeObjectURL(t.url)})}},[l.value]);const h=n.useMemo(()=>{const r=x.map((t,a)=>({type:"existing",url:t,existingIndex:a})),s=g.map(t=>({type:"new",url:t.url,fileIndex:t.fileIndex}));return[...r,...s]},[g,x]),F=x.length,C=g.length,d=F+C,N=r=>{const s=Array.from(r.target.files||[]);if(s.length>0){const t=Array.isArray(l.value)?l.value.filter(f=>f instanceof File):[],a=Math.max(c-F-t.length,0),o=s.slice(0,a),p=[...t,...o];l.onChange(p)}r.target.value=""},E=r=>{if(r.type==="existing"){m(a=>{const o=a.filter((p,f)=>!(f===r.existingIndex&&p===r.url));return I?.(o),o});return}const t=(Array.isArray(l.value)?l.value.filter(a=>a instanceof File):[]).filter((a,o)=>o!==r.fileIndex);l.onChange(t)},M=d<c;return e.jsxs(P,{className:y("flex flex-col space-y-2",k),children:[b&&e.jsx(R,{children:b}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[h.map((r,s)=>e.jsx("div",{className:"relative group rounded-md border overflow-hidden",children:r.url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.url,alt:`Aperçu ${s+1}`,className:"w-full h-32 object-cover"}),e.jsx("button",{type:"button",onClick:()=>E(r),className:"absolute right-2 top-2 rounded-full bg-black/50 p-1 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(G,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center bg-muted",children:e.jsx(w,{className:"h-8 w-8 text-muted-foreground"})})},s)),M&&e.jsxs("label",{htmlFor:j,className:y("relative flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 p-4 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-800/50 h-32"),children:[e.jsx("input",{id:j,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:N}),e.jsx(S,{className:"mb-2 h-6 w-6 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Ajouter"})]})]}),h.length===0&&e.jsxs("label",{htmlFor:v,className:y("relative flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 p-8 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-800/50"),children:[e.jsx("input",{id:v,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:N}),e.jsx(w,{className:"mb-2 h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cliquez pour télécharger ou glisser-déposer"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF (max. 2MB par image)"})]}),e.jsx(L,{}),h.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d," image",d>1?"s":""," sélectionnée",d>1?"s":"",c&&` (maximum ${c})`]})]})}export{T as M};
