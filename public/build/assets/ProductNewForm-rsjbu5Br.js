import{r as S,j as e,a as f}from"./app-CXlkSNpp.js";import{u as w,a as E,F as P,b as n,I as L,c,d as l,e as m,f as x,g as p,T as M,o as U,j as b,h as v,i as I,s as u,n as D}from"./ImageUploadField-D56VYx-p.js";import{B as z}from"./createLucideIcon-TuM7M0fl.js";import{I as N}from"./input-DNPMUi4O.js";import{S as C}from"./switch-BqHa5TtF.js";import{M as B}from"./MultiImageUploadField-cdYX7BoN.js";import{a as T,b as V}from"./useProducts-DGwjVx5K.js";import{L as R}from"./loader-circle-Ditl4NiH.js";const q=U({name:u().min(2,{message:"Le nom doit contenir au moins 2 caractères."}),price:D().min(0,{message:"Le prix doit être supérieur ou égal à 0."}),description:u().optional(),image_principale:I().optional(),images_secondaires:v(I()).optional(),existing_images_secondaires:v(u()).optional(),en_stock:b(),active:b()});function Y({product:i}){const r=!!i,h=T(),j=V(),_=r?j:h,a=w({resolver:E(q),defaultValues:{name:i?.name??"",price:i?.price??0,description:i?.description??"",en_stock:r?i?.en_stock??!0:!0,active:r?i?.active??!0:!0,image_principale:void 0,images_secondaires:[],existing_images_secondaires:i?i.images_secondaires??[]:void 0}});S.useEffect(()=>{i&&a.reset({name:i.name,price:i.price,description:i.description||"",en_stock:i.en_stock,active:i.active,image_principale:void 0,images_secondaires:[],existing_images_secondaires:i.images_secondaires??[]})},[i,a]);const F=a.watch("existing_images_secondaires")??[],y=s=>{a.setValue("existing_images_secondaires",s,{shouldDirty:!0})};function k(s){const o=(s.images_secondaires||[]).filter(t=>t instanceof File),d=s.existing_images_secondaires??i?.images_secondaires??[],g={name:s.name,price:s.price,description:s.description||"",en_stock:s.en_stock,active:s.active,image_principale:s.image_principale instanceof File?s.image_principale:void 0,images_secondaires:o,existing_images_secondaires:d};console.log("Form data to send:",g),r&&i?j.mutate({id:i.id.toString(),data:g},{onSuccess:t=>{console.log("Produit mis à jour :",t),f.visit("/products/home",{replace:!0})},onError:t=>{console.error("Erreur lors de la mise à jour:",t)}}):(console.log("Création du produit :",g),h.mutate(g,{onSuccess:()=>{f.visit("/products/home",{replace:!0})}}))}return e.jsx(P,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(k),className:"space-y-8 p-4",children:[e.jsxs("div",{className:"flex items-start md:flex-row flex-col space-x-4",children:[e.jsx(n,{control:a.control,name:"image_principale",render:({field:s})=>e.jsx(L,{label:"Image principale",field:s,defaultImageUrl:i?.image_principale||void 0})}),e.jsxs("div",{className:"w-full md:w-3/4 space-y-4",children:[e.jsx(n,{control:a.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Nom du produit"}),e.jsx(m,{children:e.jsx(N,{placeholder:"Nom du produit...",...s})}),e.jsx(x,{children:"Nom public du produit."}),e.jsx(p,{})]})}),e.jsx(n,{control:a.control,name:"price",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Prix"}),e.jsx(m,{children:e.jsx(N,{type:"number",step:"0.01",placeholder:"0.00",value:s.value||"",onChange:o=>{const d=parseFloat(o.target.value);s.onChange(isNaN(d)?0:d)}})}),e.jsx(x,{children:"Prix du produit en euros."}),e.jsx(p,{})]})}),e.jsx(n,{control:a.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Description"}),e.jsx(m,{children:e.jsx(M,{placeholder:"Décrivez le produit en détail...",className:"min-h-[120px]",...s})}),e.jsx(p,{})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-4",children:[e.jsx(n,{control:a.control,name:"en_stock",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"En stock"}),e.jsx(x,{children:"Le produit est disponible en stock."})]}),e.jsx(m,{children:e.jsx(C,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(n,{control:a.control,name:"active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"Produit actif"}),e.jsx(x,{children:"Le produit sera visible s'il est actif."})]}),e.jsx(m,{children:e.jsx(C,{checked:s.value,onCheckedChange:s.onChange})})]})})]})]})]}),e.jsx(n,{control:a.control,name:"images_secondaires",render:({field:s})=>e.jsx(B,{label:"Images secondaires",field:{onChange:o=>s.onChange(o),value:s.value||[]},defaultImageUrls:i?.images_secondaires||[],existingImageUrls:F,onExistingImagesChange:y,maxImages:10})}),e.jsxs(z,{type:"submit",disabled:_.isPending,children:[_.isPending&&e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Mettre à jour":"Créer le produit"]})]})})}export{Y as P};
