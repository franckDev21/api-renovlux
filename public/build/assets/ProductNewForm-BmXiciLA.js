import{r as x,j as e,a as M}from"./app-CM9Os29j.js";import{c as f,d as b,k as R,g as k,u as $,a as q,F as J,b as h,I as W,e as F,f as C,T as X,S as U,o as H,j as D,h as z,s as E,i as B,n as K}from"./ImageUploadField-C0TPbYeO.js";import{c as L,B as Q}from"./createLucideIcon-B7wNz9HT.js";import{I as G}from"./input-Dx9s5MLT.js";import{X as Y}from"./app-layout-BXH1unG1.js";import{P as Z}from"./plus-Bx5T-vu_.js";import{a as ee,b as se}from"./useProducts-CdIMPruF.js";import{L as re}from"./loader-circle-CNpIcbDP.js";function ie({label:r="Images",field:a,defaultImageUrls:p=[],existingImageUrls:l=[],onExistingImagesChange:I,className:n,maxImages:v=10}){const[y,_]=x.useState(l.length>0?l:p),[N,s]=x.useState([]),d=x.useId(),u=x.useId();x.useEffect(()=>{l.length>0?_(l):_(p)},[l,p]),x.useEffect(()=>{const o=(Array.isArray(a.value)?a.value.filter(i=>i instanceof File):[]).map((i,c)=>({url:URL.createObjectURL(i),fileIndex:c}));return s(o),()=>{o.forEach(i=>{i.url.startsWith("blob:")&&URL.revokeObjectURL(i.url)})}},[a.value]);const m=x.useMemo(()=>{const t=y.map((i,c)=>({type:"existing",url:i,existingIndex:c})),o=N.map(i=>({type:"new",url:i.url,fileIndex:i.fileIndex}));return[...t,...o]},[N,y]),g=y.length,T=N.length,w=g+T,A=t=>{const o=Array.from(t.target.files||[]);if(o.length>0){const i=Array.isArray(a.value)?a.value.filter(S=>S instanceof File):[],c=Math.max(v-g-i.length,0),j=o.slice(0,c),P=[...i,...j];a.onChange(P)}t.target.value=""},V=t=>{if(t.type==="existing"){_(c=>{const j=c.filter((P,S)=>!(S===t.existingIndex&&P===t.url));return I?.(j),j});return}const i=(Array.isArray(a.value)?a.value.filter(c=>c instanceof File):[]).filter((c,j)=>j!==t.fileIndex);a.onChange(i)},O=w<v;return e.jsxs(f,{className:L("flex flex-col space-y-2",n),children:[r&&e.jsx(b,{children:r}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[m.map((t,o)=>e.jsx("div",{className:"relative group rounded-md border overflow-hidden",children:t.url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.url,alt:`Preview ${o+1}`,className:"w-full h-32 object-cover"}),e.jsx("button",{type:"button",onClick:()=>V(t),className:"absolute right-2 top-2 rounded-full bg-black/50 p-1 text-white hover:bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Y,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center bg-muted",children:e.jsx(R,{className:"h-8 w-8 text-muted-foreground"})})},o)),O&&e.jsxs("label",{htmlFor:d,className:L("relative flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 p-4 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-800/50 h-32"),children:[e.jsx("input",{id:d,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:A}),e.jsx(Z,{className:"mb-2 h-6 w-6 text-gray-400"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Ajouter"})]})]}),m.length===0&&e.jsxs("label",{htmlFor:u,className:L("relative flex cursor-pointer flex-col items-center justify-center rounded-md border-2 border-dashed border-gray-300 p-8 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-800/50"),children:[e.jsx("input",{id:u,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:A}),e.jsx(R,{className:"mb-2 h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cliquez pour télécharger ou glisser-déposer"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF (max. 2MB par image)"})]}),e.jsx(k,{}),m.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[w," image",w>1?"s":""," sélectionnée",w>1?"s":"",v&&` (maximum ${v})`]})]})}const ae=H({name:E().min(2,{message:"Le nom doit contenir au moins 2 caractères."}),price:K().min(0,{message:"Le prix doit être supérieur ou égal à 0."}),description:E().optional(),image_principale:B().optional(),images_secondaires:z(B()).optional(),existing_images_secondaires:z(E()).optional(),en_stock:D(),active:D()});function xe({product:r}){const a=!!r,p=ee(),l=se(),I=a?l:p,n=$({resolver:q(ae),defaultValues:{name:r?.name??"",price:r?.price??0,description:r?.description??"",en_stock:a?r?.en_stock??!0:!0,active:a?r?.active??!0:!0,image_principale:void 0,images_secondaires:[],existing_images_secondaires:r?r.images_secondaires??[]:void 0}});x.useEffect(()=>{r&&n.reset({name:r.name,price:r.price,description:r.description||"",en_stock:r.en_stock,active:r.active,image_principale:void 0,images_secondaires:[],existing_images_secondaires:r.images_secondaires??[]})},[r,n]);const y=n.watch("existing_images_secondaires")??[],_=s=>{n.setValue("existing_images_secondaires",s,{shouldDirty:!0})};function N(s){const d=(s.images_secondaires||[]).filter(g=>g instanceof File),u=s.existing_images_secondaires??r?.images_secondaires??[],m={name:s.name,price:s.price,description:s.description||"",en_stock:s.en_stock,active:s.active,image_principale:s.image_principale instanceof File?s.image_principale:void 0,images_secondaires:d,existing_images_secondaires:u};console.log("Form data to send:",m),a&&r?l.mutate({id:r.id.toString(),data:m},{onSuccess:g=>{console.log("Produit mis à jour :",g),M.visit("/products/home",{replace:!0})},onError:g=>{console.error("Erreur lors de la mise à jour:",g)}}):(console.log("Création du produit :",m),p.mutate(m,{onSuccess:()=>{M.visit("/products/home",{replace:!0})}}))}return e.jsx(J,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(N),className:"space-y-8 p-4",children:[e.jsxs("div",{className:"flex items-start md:flex-row flex-col space-x-4",children:[e.jsx(h,{control:n.control,name:"image_principale",render:({field:s})=>e.jsx(W,{label:"Image principale",field:s,defaultImageUrl:r?.image_principale||void 0})}),e.jsxs("div",{className:"w-full md:w-3/4 space-y-4",children:[e.jsx(h,{control:n.control,name:"name",render:({field:s})=>e.jsxs(f,{children:[e.jsx(b,{children:"Nom du produit"}),e.jsx(F,{children:e.jsx(G,{placeholder:"Nom du produit...",...s})}),e.jsx(C,{children:"Nom public du produit."}),e.jsx(k,{})]})}),e.jsx(h,{control:n.control,name:"price",render:({field:s})=>e.jsxs(f,{children:[e.jsx(b,{children:"Prix"}),e.jsx(F,{children:e.jsx(G,{type:"number",step:"0.01",placeholder:"0.00",value:s.value||"",onChange:d=>{const u=parseFloat(d.target.value);s.onChange(isNaN(u)?0:u)}})}),e.jsx(C,{children:"Prix du produit en euros."}),e.jsx(k,{})]})}),e.jsx(h,{control:n.control,name:"description",render:({field:s})=>e.jsxs(f,{children:[e.jsx(b,{children:"Description"}),e.jsx(F,{children:e.jsx(X,{placeholder:"Décrivez le produit en détail...",className:"min-h-[120px]",...s})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-4",children:[e.jsx(h,{control:n.control,name:"en_stock",render:({field:s})=>e.jsxs(f,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(b,{className:"text-base",children:"En stock"}),e.jsx(C,{children:"Le produit est disponible en stock."})]}),e.jsx(F,{children:e.jsx(U,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(h,{control:n.control,name:"active",render:({field:s})=>e.jsxs(f,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(b,{className:"text-base",children:"Produit actif"}),e.jsx(C,{children:"Le produit sera visible s'il est actif."})]}),e.jsx(F,{children:e.jsx(U,{checked:s.value,onCheckedChange:s.onChange})})]})})]})]})]}),e.jsx(h,{control:n.control,name:"images_secondaires",render:({field:s})=>e.jsx(ie,{label:"Images secondaires",field:{onChange:d=>s.onChange(d),value:s.value||[]},defaultImageUrls:r?.images_secondaires||[],existingImageUrls:y,onExistingImagesChange:_,maxImages:10})}),e.jsxs(Q,{type:"submit",disabled:I.isPending,children:[I.isPending&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Mettre à jour":"Créer le produit"]})]})})}export{xe as P};
